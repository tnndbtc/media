You are an AI assistant that always provides full, uninterrupted answers.
Never stop mid-output unless you reach a hard token limit.

You are a senior AI systems architect and multilingual NLP engineer.

Design and generate a complete architectural plan and production-ready code template for building a large-scale AI agent system with the following capabilities:

========================================
SYSTEM PURPOSE
========================================

Build an AI agent that:

1. Accepts a block of natural language text as input.
   - The text may be in ANY language (English, Chinese, Japanese, Korean, Spanish, French, German, Arabic, etc).
2. Automatically detects the language.
3. Performs multilingual semantic understanding.
4. Converts the text into optimized English + native-language semantic search queries.
5. Uses OpenAI API to:
   - Extract semantic intent
   - Generate multilingual search queries
   - Expand keywords across languages
   - Generate structured search filters
6. Automatically queries:
   - Pexels API (images + videos)
   - Pixabay API (images + videos)
7. Filters, ranks, deduplicates, and scores results based on:
   - Cross-lingual semantic relevance
   - Visual quality signals
   - Scene matching accuracy
   - Emotional tone match
   - Popularity / engagement
8. Returns:
   - Ranked list of image + video URLs
   - Metadata
   - Optional thumbnails
   - Cross-lingual relevance confidence
9. Exposes a production-grade **REST API service** so that:
   - Other systems can programmatically invoke it.

========================================
CORE MULTILINGUAL DESIGN REQUIREMENT
========================================

The system MUST support:

- Automatic language detection
- Multilingual NLP parsing
- Cross-lingual semantic mapping
- Language-aware query generation
- Bilingual query execution strategy:
    - Native language query
    - English semantic query
- Automatic keyword translation + synonym expansion
- Cultural scene interpretation
- Emotion + tone extraction across languages

========================================
FUNCTIONAL REQUIREMENTS
========================================

Input:
- A block of free-form multilingual text (story, narration, article, script, news, product description, etc)

Output:
- JSON payload:
  - Detected language
  - Extracted intent
  - Generated multilingual search queries
  - Ranked image list
  - Ranked video list
  - Metadata (source, resolution, aspect ratio, license, tags)
  - Semantic relevance score per asset
  - Cross-lingual confidence score

Core Flow:
1. Language detection
2. Multilingual semantic parsing
3. Intent + emotion + scene extraction
4. Multilingual query generation
5. Parallel API orchestration (Pexels + Pixabay)
6. AI semantic scoring + ranking
7. REST response output

========================================
SYSTEM ARCHITECTURE
========================================

Design a modular microservice-style architecture:

- API Gateway (FastAPI)
- Multilingual AI Orchestrator Agent
- Language Detection Agent
- Cross-lingual Query Generator Agent
- Media Fetch Agent
- Semantic Relevance Ranking Agent
- Result Aggregator
- Cache Layer (Redis)
- Async Task Engine (AsyncIO / Celery)
- Rate Limit + Retry Layer

========================================
AI COMPONENT DESIGN
========================================

Use OpenAI API for:

1. Language detection
2. Intent extraction
3. Scene extraction
4. Emotional tone extraction
5. Multilingual keyword expansion
6. Cross-lingual semantic ranking
7. Caption similarity scoring

Design prompts that:
- Convert multilingual free text â†’ structured multilingual search queries
- Expand culturally relevant visual concepts
- Generate English + native language queries
- Extract cinematic and visual styles

========================================
MULTILINGUAL MEDIA SEARCH STRATEGY
========================================

Implement a bilingual + multilingual retrieval pipeline:

- For each input:
    1. Native-language semantic query
    2. English-translated semantic query
    3. Scene + emotion-based keyword query
    4. Synonym + hypernym expansion queries

Perform:
- Parallel search execution
- Result pooling
- Deduplication
- Cross-language semantic reranking

========================================
MEDIA SEARCH PIPELINE
========================================

Generate dynamic queries for:

Pexels API:
- image search
- video search

Pixabay API:
- image search
- video search

Include:
- Multi-query parallel search
- Language-aware query construction
- Deduplication logic
- Semantic reranking formula
- Final ranking algorithm

========================================
REST API DESIGN
========================================

Provide endpoint designs:

POST /search
POST /batch-search
POST /analyze
GET  /health

Request:
{
  "text": "...",
  "media_type": ["image", "video"],
  "limit": 20,
  "aspect_ratio": "16:9",
  "style": "cinematic",
  "language_hint": "auto"
}

Response:
{
  "detected_language": "zh",
  "query_summary": {
      "intent": "...",
      "emotion": "...",
      "scene": "...",
      "queries": ["..."]
  },
  "ranked_images": [...],
  "ranked_videos": [...],
  "latency_ms": 123,
  "semantic_confidence": 0.92
}

========================================
SYSTEM PERFORMANCE
========================================

Design for:
- Async concurrency
- Query parallelization
- Multi-stage caching
- Rate-limit safety
- Circuit breakers
- Retry policies
- Distributed task execution

========================================
SECURITY
========================================

- API key vault design
- Rate limit
- Abuse prevention
- Request validation
- Prompt injection defense
- Multilingual prompt sanitization

========================================
DEPLOYMENT
========================================

Provide:

- Docker container architecture
- Kubernetes-ready structure
- Horizontal autoscaling design
- GPU optional acceleration pipeline
- Cloud deployment blueprint (AWS / GCP / Azure)

========================================
CODE STRUCTURE
========================================

Generate:

Complete project skeleton:

/app
  /api
  /agents
  /pipelines
  /services
  /models
  /ranking
  /multilingual
  /config
  /utils
  main.py

Include:

- FastAPI app
- Async HTTP clients
- OpenAI integration
- Pexels API client
- Pixabay API client
- Language detection module
- Multilingual semantic pipeline
- Ranking module
- Cache adapter
- Example multilingual prompts

========================================
IMPLEMENTATION REQUIREMENTS
========================================

Generate:

- Full system architecture explanation
- Component interaction diagrams (ASCII)
- Full Python FastAPI template code
- Async pipeline orchestration code
- Modular agent pattern
- OpenAI multilingual prompt templates
- API request / response models
- Error handling
- Logging
- Metrics hooks

========================================
QUALITY LEVEL
========================================

Write at senior engineer / AI architect quality:

- Production-grade
- Scalable
- Multilingual
- Modular
- Testable
- Maintainable
- Cloud-native

========================================
DELIVERABLE
========================================

Return:

1. System architecture explanation
2. Execution flow diagram
3. Full project directory structure
4. Production-ready Python FastAPI code template
5. OpenAI multilingual prompt templates
6. Deployment instructions

========================================

This system must be suitable for:
- Global multilingual AI services
- Commercial-grade deployments
- High-scale production workloads
- Cross-border content platforms
